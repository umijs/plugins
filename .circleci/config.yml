version: 2.1
orbs:
  cypress: cypress-io/cypress@1.26.0
  node: circleci/node@4.3.0

jobs:
  unit-test:
    docker:
      - image: 'cimg/base:stable'
    steps:
      - checkout
      - node/install:
          install-yarn: true
      - run: yarn build
      - run: yarn test --forceExit


workflows:
  run:
    jobs:
      - cypress/run:
          executor: cypress/base-14
          yarn: true
          cache-key: yarn-packages-{{ arch }}-{{ checksum "yarn.lock" }}
          build: yarn build
          start: cd example && npm start
          wait-on: 'http://localhost:8000'
          config-file: ./example/cypress.json
          spec: ./example/cypress/**/*
  unit-test:
    jobs:
      - unit-test

